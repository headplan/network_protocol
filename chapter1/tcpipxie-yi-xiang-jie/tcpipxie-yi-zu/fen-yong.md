# 分用

当真到达目的主机时 , 将沿着协议栈自底向上一次传递 . 各层协议依次处理帧中本层负责的头部数据 , 以获取所需的信息 , 并最终将处理后的帧交给目标应用程序 . 这个过程称为分用 . 分用是依靠头部信息中的类型字段实现的 .

![](/assets/fenyong.png)因为IP协议,ARP协议和RARP协议都是用帧传输数据 , 所以帧的头部需要提供某个字段来区分他们 , 具体情况取决于帧的类型 . 例如以太网的帧 , 它使用2字节的类型字段来标识上层协议 . 如果主机接收到的以太网帧类型字段的值的0x800 , 则帧的数据部分为IP数据报 , 以太网驱动程序就将帧交付给IP模块 , 类型字段的值为0x806 , 则帧的数据部分为ARP请求和应答报文 , 以太网驱动程序就是将帧交付给APR模块 , 若类型字段的值为0x835 , 则帧的数据部分为RARP请求或应答报文 , 以太网驱动程序就将帧交付给RARP模块 .

因为ICMP协议,TCP协议和UDP协议都使用IP协议 , 所以IP数据报的头部采用16位的协议字段来区分它们 . TCP报文段和UDP数据报则通过其头部中的16位的端口号字段来区分上层应用程序 . 比如DNS协议对应的端口号是53 , HTTP协议对应的端口号是80 . 所有指明应用层协议使用的端口号都可以在/etc/services文件中找到 .

帧通过上面的分用步骤后 , 最终将封装前的原始数据送至目标服务 . 这样 , 在顶层目标服务看来封装和分用似乎没有发生过 . 

